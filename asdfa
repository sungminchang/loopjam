<!doctype HTML>
<html>
<head>

<meta charset="utf-8">
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="bufferLoader.js"></script>
<script src="recordingSources.js"></script>

</head>
<body>
<canvas></canvas>
  <button id="sound1" value="0">Play</button>
  <button id="sound2" value="1">Play</button>
</div>

<script>

/////////// Initialize AudioContext, Bufferloader ////////
////////////////////////////////////////////////////

var context; 
var bufferLoader;

var data = [
{url: "metronome2.mp3", speed:2, port:0, recordedAtBpm: 120}, 
{url: "tambourines2.mp3", speed:2, port:1, recordedAtBpm: 120}
];

var init = function() {

  var contextClass = (window.AudioContext || 
    window.webkitAudioContext || 
    window.mozAudioContext || 
    window.oAudioContext || 
    window.msAudioContext);


  if (contextClass) {
    // alert("it works")
    context = new contextClass();
    console.log('context created: ', context);

    bufferLoader = new BufferLoader(
      context,
      data
      );

    console.log('context modified: ', context);


    bufferLoader.load();

  } else {
    alert('Web Audio API is not available');
    // Web Audio API is not available. Ask the user to use a supported browser.
  }

  // setInterval = (function(){
  // source.loopEnd -= 0.1
  // }, 20)

  // source.loopStart;
  // source.loopEnd;
};

window.onload = init;


///////// Create Instance of AudioContext //////////
////////////////////////////////////////////////////

var play = function(button) {
  // getFile(sound.url, function(data) {
    var soundIndex = button.value;
    var soundData = data[soundIndex];

    console.log('playing a sound: ', soundData);

    var source = soundData.source = context.createBufferSource();
    soundData.source.buffer = bufferLoader.bufferList[soundIndex];
    soundData.source.loop = true;
    // source.playbackRate.value = playbackControl.value;
    soundData.source.connect(context.destination);
    soundData.source.start();
    soundData.source.loopStart = 0;
    soundData.source.loopEnd = 2;

    source.onended = function() {
      console.log('Your audio has finished playing');
    };

    console.log('source', source);
};

var pause = function(button) {
  var soundIndex = button.value;
  var soundData = data[soundIndex];

  // Instead of creating a new bufferSource as per usual,
  // we retrieve the source that we have stored on our 
  // data objects.
  var source = soundData.source;
  source.buffer = bufferLoader.bufferList[soundIndex];
  console.log('About to pause, logging source: ', source);
  source.stop();
};

var toggle = function(button) {
  console.log('button: ', button);
  // var data = button.split(" ")
  // console.log('data: ', data);
  console.log(button.value)
  if (button.innerHTML == "Play") {
    button.innerHTML = "Pause";
    play(button);
  } else {
    button.innerHTML = "Play";
    pause(button);
  }
};

// playbackControl.oninput = function() {
//   sound.playbackRate.value = playbackControl.value;
//   playbackValue.innerHTML = playbackControl.value;
// }

$(document).ready(function(){
  $("#sound1").on("click", function(e) {
    console.log('button clicked');
    toggle(e.target);
  });
  $("#sound2").on("click", function(e) {
    toggle(e.target);
  });
  
});
</script>

</body>
</html>