<!doctype html>
<html>
  <head>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="bower_components/howler/howler.min.js"></script>
  <button class="play">Play</button>
  <button class="stop">Stop</button>
  <button class="tempoChange">TempoChange</button>

  <button class="playBass">Play Bassline</button>
  <button class="stopBass">Stop Bassline </button>
  <button class="tempoChangeBass">TempoChange Bassline</button>


  <script>
      var audioCtx = new (window.AudioContext || window.webkitAudioContext)(); // define audio context
      

      var timeInitial = audioCtx.currentTime;

      var tick = new Howl({urls: ['http://www.javascriptoo.com/application/html/pong.wav'], volume: 0.15});

      var count = 0;
      setInterval(function() {
        console.log(count % 4);
        count++;
        // tick.play();
      }, 500);

      var recording = new Howl(
        {
          urls: ['./audio.m4a'],
          loop: true,
          autoplay: false,
          volume: 2
        });

      var metronome = new Howl(
        {
          urls: ['./metronome2.mp3'],
          loop: true,
          autoplay: false
        });
      
      var bassline = new Howl(
        {
          urls: ['./tambourines2.mp3'],
          loop: true,
          autoplay: false,
          volume: 0.5
        });

      // recording.play();

      $('.tempoChange').on('click', function() {
        console.log('changing tempo');
        recording.unload();
        recording = new Howl(
        {
          urls: ['./audio.m4a'],
          loop: true,
          autoplay: true,
          rate: 0.5
        });
      });
      
      $('.tempoChangeBass').on('click', function() {
        console.log('changing tempo');
        bassline.unload();
        bassline = new Howl(
        {
          urls: ['./bassline.mp3'],
          loop: true,
          autoplay: true,
          rate: 0.5
        });
      });

      $('.play').on('click', function(){
        metronome.play();
        bassline.play();
      });

      $('.playBass').on('click', function(){ 
        console.log('playing');
        var barTime = 2;


        // Get current time, then find remainder when you've divided by bartime to get how much distance we have till bartime;
        var currentTime = audioCtx.currentTime;
        var remainder = currentTime % barTime;
        console.log('currentTime:', currentTime);


        var delay = barTime - remainder;
        console.log('delay: ', delay);

        console.log('expected time of play: ', delay + currentTime);

        setTimeout(function() {
          console.log('playing at ', audioCtx.currentTime);
          bassline.unmute();
          console.log('played at ', audioCtx.currentTime);

        }, delay * 1000);

      });

      

      $('.stop').on('click', function(){
        console.log('pausing');
        recording.mute();
      });

      $('.stopBass').on('click', function(){
        console.log('pausing');
        bassline.mute();
      });


  </script>

  </head>
  <body>
  </body>
</html>